<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>安全管理系统</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; }
        .sidebar { background-color: #343a40; min-height: 100vh; }
        .sidebar .nav-link { color: rgba(255,255,255,.5); }
        .sidebar .nav-link:hover { color: rgba(255,255,255,.75); }
        .sidebar .nav-link.active { color: #fff; }
        .card { box-shadow: 0 0.125rem 0.25rem rgba(0,0,0,.075); }
        .stat-card { transition: transform 0.2s; }
        .stat-card:hover { transform: translateY(-5px); }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <!-- 侧边栏 -->
            <nav class="col-md-2 d-none d-md-block sidebar">
                <div class="position-sticky pt-3">
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link active" href="#dashboard">
                                <i class="fas fa-tachometer-alt me-2"></i>仪表板
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/security/users">
                                <i class="fas fa-users me-2"></i>用户管理
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/security/roles">
                                <i class="fas fa-user-tag me-2"></i>角色管理
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/security/permissions">
                                <i class="fas fa-key me-2"></i>权限管理
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/security/audit">
                                <i class="fas fa-file-alt me-2"></i>安全审计
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/security/auth-config">
                                <i class="fas fa-cog me-2"></i>认证配置
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- 主内容区 -->
            <main class="col-md-10 ms-sm-auto px-md-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">安全管理系统</h1>
                    <div class="btn-toolbar mb-2 mb-md-0">
                        <div class="btn-group me-2">
                            <button type="button" class="btn btn-sm btn-outline-secondary">
                                <i class="fas fa-sync-alt"></i> 刷新
                            </button>
                        </div>
                    </div>
                </div>

                <!-- 统计卡片 -->
                <div class="row mb-4">
                    <div class="col-md-3 mb-3">
                        <div class="card stat-card h-100">
                            <div class="card-body text-center">
                                <i class="fas fa-users fa-2x text-primary mb-2"></i>
                                <h5 class="card-title">在线用户</h5>
                                <h2 class="text-primary" id="onlineUsers">0</h2>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="card stat-card h-100">
                            <div class="card-body text-center">
                                <i class="fas fa-shield-alt fa-2x text-success mb-2"></i>
                                <h5 class="card-title">安全事件</h5>
                                <h2 class="text-success" id="securityEvents">0</h2>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="card stat-card h-100">
                            <div class="card-body text-center">
                                <i class="fas fa-key fa-2x text-warning mb-2"></i>
                                <h5 class="card-title">活跃令牌</h5>
                                <h2 class="text-warning" id="activeTokens">0</h2>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="card stat-card h-100">
                            <div class="card-body text-center">
                                <i class="fas fa-exclamation-triangle fa-2x text-danger mb-2"></i>
                                <h5 class="card-title">警告事件</h5>
                                <h2 class="text-danger" id="warningEvents">0</h2>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 最近活动 -->
                <div class="row">
                    <div class="col-md-8">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0"><i class="fas fa-history me-2"></i>最近安全事件</h5>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-striped">
                                        <thead>
                                            <tr>
                                                <th>时间</th>
                                                <th>事件类型</th>
                                                <th>用户</th>
                                                <th>IP地址</th>
                                                <th>状态</th>
                                            </tr>
                                        </thead>
                                        <tbody id="recentEvents">
                                            <tr>
                                                <td colspan="5" class="text-center">暂无数据</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0"><i class="fas fa-chart-pie me-2"></i>安全状态</h5>
                            </div>
                            <div class="card-body">
                                <div class="d-grid gap-2">
                                    <button class="btn btn-success" onclick="checkSecurity()">
                                        <i class="fas fa-check-circle me-2"></i>安全检查
                                    </button>
                                    <button class="btn btn-warning" onclick="viewAuditLog()">
                                        <i class="fas fa-search me-2"></i>查看审计日志
                                    </button>
                                    <button class="btn btn-info" onclick="manageUsers()">
                                        <i class="fas fa-user-cog me-2"></i>用户管理
                                    </button>
                                    <button class="btn btn-secondary" onclick="configAuth()">
                                        <i class="fas fa-cogs me-2"></i>安全配置
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            loadDashboardData();
            setInterval(loadDashboardData, 30000); // 每30秒刷新一次
        });

        // 加载仪表板数据
        function loadDashboardData() {
            // 模拟数据加载
            document.getElementById('onlineUsers').textContent = Math.floor(Math.random() * 50) + 10;
            document.getElementById('securityEvents').textContent = Math.floor(Math.random() * 100) + 50;
            document.getElementById('activeTokens').textContent = Math.floor(Math.random() * 200) + 100;
            document.getElementById('warningEvents').textContent = Math.floor(Math.random() * 10);
            
            // 模拟最近事件
            loadRecentEvents();
        }

        // 加载最近事件
        function loadRecentEvents() {
            const events = [
                {time: '2024-01-15 10:30:25', type: '登录成功', user: 'admin', ip: '192.168.1.100', status: '成功'},
                {time: '2024-01-15 10:25:12', type: '权限检查', user: 'user001', ip: '192.168.1.101', status: '通过'},
                {time: '2024-01-15 10:20:45', type: '登录失败', user: 'test', ip: '192.168.1.102', status: '失败'},
                {time: '2024-01-15 10:15:33', type: 'Token刷新', user: 'admin', ip: '192.168.1.100', status: '成功'}
            ];
            
            const tbody = document.getElementById('recentEvents');
            tbody.innerHTML = '';
            
            events.forEach(event => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${event.time}</td>
                    <td>${event.type}</td>
                    <td>${event.user}</td>
                    <td>${event.ip}</td>
                    <td><span class="badge bg-${event.status === '成功' ? 'success' : 'danger'}">${event.status}</span></td>
                `;
                tbody.appendChild(row);
            });
        }

        // 功能按钮处理
        function checkSecurity() {
            alert('执行安全检查...');
        }

        function viewAuditLog() {
            window.location.href = '/security/audit';
        }

        function manageUsers() {
            window.location.href = '/security/users';
        }

        function configAuth() {
            window.location.href = '/security/auth-config';
        }
    </script>
</body>
</html>